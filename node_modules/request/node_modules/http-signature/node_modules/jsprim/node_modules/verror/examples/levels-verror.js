/*******************************************************************************
 *Copyright (C) 2017 FBK.
 *All rights reserved. This program and the accompanying materials
 *are made available under the terms of the Eclipse Public License v1.0
 *which accompanies this distribution, and is available at
 *http://www.eclipse.org/legal/epl-v10.html
 *
 *Contributors:
 *    FBK - initial API and implementation
 ******************************************************************************/
var extsprintf = require('extsprintf');
var fs = require('fs');
var verror = require('../lib/verror');

function checkFile(filename, callback) {
	fs.stat(filename, function (err) {
		if (err)
			/* Annotate the "stat" error with what we were doing. */
			return (callback(new verror.VError(err,
			    'failed to check "%s"', filename)));

		/* ... */
		return (callback());
	});
}

function handleRequest(filename, callback) {
	checkFile('/nonexistent', function (err) {
		if (err)
			/* Annotate the "checkFile" error. */
			return (callback(new verror.VError(
			    err, 'request failed')));

		/* ... */
		return (callback());
	});
}

handleRequest('/nonexistent', function (err) {
	if (err) {
		console.log(err.message);
		console.log(extsprintf.sprintf('%r', err));
	}

    /* ... */
});
